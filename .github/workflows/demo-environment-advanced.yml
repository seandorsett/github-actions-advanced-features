name: "Demo 8: Environment Protection - Advanced"

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'demos/environment-protection/**'

permissions:
  contents: read

jobs:
  build:
    name: Build Application
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Build application
        run: |
          echo "üî® Building application..."
          echo "Build completed successfully!"
      
      - name: Run tests
        run: |
          echo "Running test suite..."
          echo "‚úÖ All tests passed!"
  
  deploy-staging:
    name: Deploy to Staging
    needs: build
    runs-on: ubuntu-latest
    permissions: {}
    environment:
      name: staging
      url: https://staging.example.com
    
    steps:
      - name: Deploy to staging
        run: |
          echo "üöÄ Deploying to staging environment"
          echo "No approval required for staging"
      
      - name: Verify deployment
        run: |
          echo "‚úÖ Staging deployment verified"
  
  deploy-production:
    name: Deploy to Production
    needs: deploy-staging
    runs-on: ubuntu-latest
    permissions: {}
    environment:
      name: production
      url: https://example.com
    
    steps:
      - name: Deploy to production
        run: |
          echo "üöÄ Deploying to production environment"
          echo "‚ö†Ô∏è  This deployment requires approval (configured in Settings)"
          echo "Deployment would proceed after approval..."
      
      - name: Run production smoke tests
        run: |
          echo "Running production smoke tests..."
          echo "‚úÖ All production tests passed!"
      
      - name: Notify stakeholders
        run: |
          echo "üìß Notifying stakeholders of production deployment"
          echo "‚úÖ Production deployment completed successfully!"
          echo "URL: https://example.com"
